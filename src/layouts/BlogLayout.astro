---
import { Image } from "astro:assets";
import BaseLayout from "@/layouts/BaseLayout.astro";
import ShareButtons from "@/components/global/ShareButtons.astro";
const { frontmatter } = Astro.props;
const postImage = typeof frontmatter.image === 'string' ? frontmatter.image : (frontmatter.image.url || frontmatter.image);
const postImageSrc = typeof postImage === 'string' ? postImage : postImage.src;

const jsonLd = {
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": frontmatter.title,
  "description": frontmatter.description,
  "image": new URL(postImageSrc, Astro.site || Astro.url.origin).href,
  "datePublished": frontmatter.pubDate,
  "author": {
    "@type": "Person",
    "name": frontmatter.author
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": Astro.url.href
  },
  "publisher": {
    "@type": "Organization",
    "name": "Entryway Essentials",
    "logo": {
      "@type": "ImageObject",
      "url": new URL("/logo.png", Astro.site || Astro.url.origin).href // Fallback logo
    }
  }
};
---

<BaseLayout 
  title={frontmatter.title} 
  description={frontmatter.description} 
  image={postImageSrc}
  canonicalURL={frontmatter.canonical}
  keywords={frontmatter.keywords}
>
  <script type="application/ld+json" set:html={JSON.stringify(jsonLd)} />
  <section>
    <div class="py-24">
      <div class="lg:text-center">
        <div class="max-w-3xl mx-auto">
          <h1
            class="text-3xl md:text-5xl text-balance font-bold font-display text-base-900 leading-tight"
          >
            {frontmatter.title}
          </h1>
          <p class="max-w-2xl mx-auto mt-6 text-base-500 text-lg md:text-xl text-balance leading-relaxed">
            <em>{frontmatter.description}</em>
          </p>
        </div>
        <Image
          width={1280}
          height={720}
          src={postImage}
          alt={typeof frontmatter.image === 'string' ? frontmatter.title : (frontmatter.image.alt || frontmatter.title)}
          loading="eager"
          decoding="async"
          class={`object-cover object-center w-full rounded-xl mt-4 ${frontmatter.imageAspectRatio ? `aspect-[${frontmatter.imageAspectRatio}]` : "aspect-12/7"}`}
        />
        <div class="flex flex-col justify-between mt-4 md:flex-row">
          <p class="text-xs text-zinc-500">
            {new Date(frontmatter.pubDate).toLocaleDateString("en-US", {
                year: "numeric",
                month: "short",
                day: "numeric",
              })} - Written by: {
              frontmatter.author
            }
          </p>
          <div class="flex flex-col md:items-end gap-3">
            <ShareButtons title={frontmatter.title} image={postImageSrc} />
            <div class="flex gap-3 text-accent-700">
              {
                (frontmatter.tags || (frontmatter.category ? [frontmatter.category] : [])).map((tag) => (
                  <span class="hover:text-accent-500 text-xs font-medium">
                    <a href={`/tags/${tag}`}>{tag}</a>
                  </span>
                ))
              }
            </div>
          </div>
        </div>
      </div>

      <div class="prose prose-base md:prose-lg prose-base-600 max-w-3xl mt-12 mx-auto px-4 sm:px-0">
        <slot />
      </div>

      <div class="mt-20 py-12 border-t border-base-200">
        <div class="flex flex-col items-center gap-6">
          <h4 class="text-lg font-display font-bold text-base-900">Enjoyed this guide? Share it!</h4>
          <ShareButtons title={frontmatter.title} image={postImageSrc} size="lg" />
        </div>
      </div>
    </div>
  </section>
</BaseLayout>
